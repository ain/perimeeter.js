<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>perimeeter.js - Example</title>
    <script src="http://maps.googleapis.com/maps/api/js?AIzaSyCK4OJf7xaO4L5wYp-eiIQSy26VNlmsdJ8&amp;sensor=false" type="text/javascript"></script>
    <script src="bower_components/js-signals/dist/signals.js"></script>
    <script src="bower_components/perimeeter.js/src/perimeeter.js"></script>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <h1>Mobile geolocation test</h1>
    <ol id="address-list"></ol>
    <div id="map"></div>
    <div class="footnote">
      <p>Current test deploys Google Maps API and Works on all mobile platforms that support W3C Geolocation standard.</p>
      <p>Copyright @ 2014 Ain Tohvri, OÃœ Flashbit. All rights reserved.</p>
    </div>
    <script type="text/javascript">
      window.onload = function() {
        var perimeeter = new Perimeeter({
          radius: 0.1,
          maxResults: 5
        }), map;
        perimeeter.getSignals().positioned.add(function(){
          var coords = perimeeter.getCoordinates();
          map = new google.maps.Map(document.getElementById('map'), {
            zoom: 18,
            center: {
              lat: coords.latitude,
              lng: coords.longitude
            }
          });
          perimeeter.getAddress();
        });
        perimeeter.getSignals().located.add(function(locations){
          var allCoords = perimeeter.getNearbyCoordinates(),
            list = '';
          allCoords.unshift(perimeeter.getCoordinates());
          allCoords.forEach(function(coords,index){
            var marker = new google.maps.Marker({
              position: new google.maps.LatLng(coords.latitude, coords.longitude),
              map: map,
              title: locations[index].geocoderResults[0].formatted_address
            }),
            infoWindow = new google.maps.InfoWindow({
              content: '<h4>' + locations[index].geocoderResults[0].formatted_address + '</h4>(' + coords.latitude + ', ' + coords.longitude + ')'
            });
            google.maps.event.addListener(marker, 'click', function(){ infoWindow.open(map, marker); });
            list += '<li>' + locations[index].geocoderResults[0].formatted_address + '</li>';
          });
          document.getElementById('address-list').innerHTML = list;
        });
        perimeeter.position();
      };
    </script>
  </body>
</html>